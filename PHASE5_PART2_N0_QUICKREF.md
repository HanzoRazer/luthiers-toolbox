# N.0 Smart Post Configurator ‚Äî Quick Reference

**Status:** ‚úÖ Production Ready (14/14 tests pass)  
**Version:** Phase 5 Part 2 Complete  
**Date:** January 2025

---

## üöÄ Quick Start

### **Access the UI**
```
Navigate to: CAM Dashboard ‚Üí Post Processors
Direct URL: http://localhost:5173/lab/posts
```

### **Create Custom Post**
1. Click "Create Post" button
2. Fill form:
   - **ID**: CUSTOM_HAAS (uppercase, numbers, underscores only)
   - **Name**: Haas VF-2
   - **Description**: Custom post for Haas VF-2
   - **Header lines**: G90, G21, G17, M6 T{{TOOL_NUMBER}}
   - **Footer lines**: M30, (End)
3. Click "Save"

### **Edit Custom Post**
1. Click "Edit" on post card
2. Modify fields (ID is read-only)
3. Click "Update"

### **Delete Custom Post**
1. Click "Delete" on post card
2. Confirm deletion
3. *Builtin posts cannot be deleted*

---

## üì¶ 5 Built-in Posts (Pre-configured)

| Post ID | Name | Description | Controller |
|---------|------|-------------|------------|
| **GRBL** | GRBL 1.1 | Hobby CNC (GRBL firmware) | GRBL 1.1f+ |
| **Mach4** | Mach4 | Industrial CNC control software | Mach4 |
| **LinuxCNC** | LinuxCNC | Open-source CNC controller | LinuxCNC 2.8+ |
| **PathPilot** | PathPilot | Tormach controller | PathPilot |
| **MASSO** | MASSO G3 | Australian CNC controller | MASSO G3 |

**Note:** Builtin posts are **read-only** (cannot edit or delete).

---

## üîå API Endpoints

### **Base URL:** `http://localhost:8000/api/posts`

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/` | List all posts |
| `GET` | `/{post_id}` | Get single post |
| `POST` | `/` | Create custom post |
| `PUT` | `/{post_id}` | Update custom post |
| `DELETE` | `/{post_id}` | Delete custom post |
| `POST` | `/validate` | Validate config |
| `GET` | `/tokens/list` | Available tokens |

---

## üé´ Available Tokens (10+)

Use in header/footer lines for dynamic G-code generation:

| Token | Description | Example Value |
|-------|-------------|---------------|
| `{{POST_ID}}` | Post-processor identifier | GRBL |
| `{{UNITS}}` | Units (mm or inch) | mm |
| `{{DATE}}` | ISO 8601 timestamp | 2025-01-13T18:30:00Z |
| `{{TOOL_DIAMETER}}` | Tool diameter | 6.0 |
| `{{TOOL_NUMBER}}` | Tool number (for ATC) | 1 |
| `{{MATERIAL}}` | Material name | Maple |
| `{{MACHINE_ID}}` | Machine profile ID | HAAS_VF2 |
| `{{FEED_XY}}` | Cutting feed rate | 1200 |
| `{{FEED_Z}}` | Plunge feed rate | 300 |
| `{{SPINDLE_RPM}}` | Spindle speed | 18000 |

**Example Usage:**
```
(POST={{POST_ID}};UNITS={{UNITS}};DATE={{DATE}})
M6 T{{TOOL_NUMBER}} (Load tool {{TOOL_DIAMETER}}mm)
S{{SPINDLE_RPM}} M3 (Start spindle)
G1 F{{FEED_XY}} (Set feed rate)
```

---

## ‚úÖ Validation Rules

### **ID Requirements (Custom Posts)**
- ‚úÖ Uppercase letters: A-Z
- ‚úÖ Numbers: 0-9
- ‚úÖ Underscores: _
- ‚ùå Cannot start with: GRBL, Mach4, LinuxCNC, PathPilot, MASSO
- ‚ùå Max length: 32 characters

### **Name Requirements**
- ‚úÖ Max length: 100 characters
- ‚úÖ Required field

### **Description**
- ‚úÖ Max length: 500 characters
- ‚úÖ Optional (recommended for documentation)

### **Header/Footer**
- ‚úÖ At least 1 line each
- ‚ö†Ô∏è Warning if line exceeds 255 characters

---

## üìù Example: Create Custom Haas Post

### **Via UI**
```
ID: HAAS_VF2
Name: Haas VF-2 with ATC
Description: Custom post for Haas VF-2 with automatic tool changer

Header:
  G90 (Absolute positioning)
  G21 (Metric units)
  G17 (XY plane)
  G54 (Work offset 1)
  (Tool changer enabled)
  M6 T{{TOOL_NUMBER}}

Footer:
  M30 (End program)
  (Generated by Luthier's Tool Box)

Metadata:
  Controller Family: haas
  G-code Dialect: Fanuc
  Supports Arcs: ‚úì
  Has Tool Changer: ‚úì
```

### **Via API (curl)**
```bash
curl -X POST http://localhost:8000/api/posts/ \
  -H 'Content-Type: application/json' \
  -d '{
    "id": "HAAS_VF2",
    "name": "Haas VF-2 with ATC",
    "description": "Custom post for Haas VF-2 with automatic tool changer",
    "header": [
      "G90",
      "G21",
      "G17",
      "G54",
      "(Tool changer enabled)",
      "M6 T{{TOOL_NUMBER}}"
    ],
    "footer": [
      "M30",
      "(Generated by Luthier'"'"'s Tool Box)"
    ],
    "metadata": {
      "controller_family": "haas",
      "gcode_dialect": "Fanuc",
      "supports_arcs": true,
      "has_tool_changer": true
    }
  }'
```

---

## üß™ Testing

### **Run Smoke Test**
```powershell
cd "C:\Users\thepr\Downloads\Luthiers ToolBox"
.\test_phase5_part2_n0_posts.ps1
```

**Expected:** 14/14 tests pass (100%)

### **Test Endpoints Manually**
```powershell
# List all posts
Invoke-RestMethod -Uri "http://localhost:8000/api/posts/" -Method GET

# Get GRBL post
Invoke-RestMethod -Uri "http://localhost:8000/api/posts/GRBL" -Method GET

# List tokens
Invoke-RestMethod -Uri "http://localhost:8000/api/posts/tokens/list" -Method GET

# Validate post config
$body = @{
  id = "TEST_POST"
  name = "Test"
  header = @("G90")
  footer = @("M30")
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8000/api/posts/validate" `
  -Method POST -Body $body -ContentType "application/json"
```

---

## üêõ Troubleshooting

### **Issue: Cannot create post with ID "GRBL_CUSTOM"**
**Error:** `Post ID cannot start with reserved prefixes`

**Solution:** Use different prefix (e.g., `CUSTOM_GRBL` instead of `GRBL_CUSTOM`)

---

### **Issue: Post list is empty**
**Diagnosis:**
```bash
# Check server logs for errors
# Verify builtin posts exist:
ls services/api/app/data/posts/*.json
```

**Expected files:** grbl.json, mach4.json, linuxcnc.json, pathpilot.json, masso.json

**Solution:** If files missing, reinstall or check repository

---

### **Issue: Cannot edit builtin post**
**Expected:** This is by design! Builtin posts are **protected** (read-only).

**Solution:** Create a custom post based on builtin:
1. Get builtin post config via API
2. Copy header/footer lines
3. Create new custom post with modified config

---

## üìä File Structure

```
services/api/app/
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îî‚îÄ‚îÄ post_router.py        # CRUD API endpoints (7 endpoints)
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ posts/
‚îÇ       ‚îú‚îÄ‚îÄ grbl.json          # Builtin GRBL post
‚îÇ       ‚îú‚îÄ‚îÄ mach4.json         # Builtin Mach4 post
‚îÇ       ‚îú‚îÄ‚îÄ linuxcnc.json      # Builtin LinuxCNC post
‚îÇ       ‚îú‚îÄ‚îÄ pathpilot.json     # Builtin PathPilot post
‚îÇ       ‚îú‚îÄ‚îÄ masso.json         # Builtin MASSO post
‚îÇ       ‚îî‚îÄ‚îÄ custom_posts.json  # User custom posts

client/src/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ post.ts                # TypeScript API client
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ PostManager.vue        # Grid view + CRUD actions
‚îÇ   ‚îî‚îÄ‚îÄ PostEditor.vue         # Modal form for create/edit
‚îî‚îÄ‚îÄ views/
    ‚îî‚îÄ‚îÄ PostManagerView.vue    # Route wrapper (/lab/posts)
```

---

## üìö Related Documentation

- [PHASE5_PART2_N0_SMART_POST_COMPLETE.md](./PHASE5_PART2_N0_SMART_POST_COMPLETE.md) ‚Äì Full integration guide
- [PATCH_N0_SMART_POST_SCAFFOLD.md](./PATCH_N0_SMART_POST_SCAFFOLD.md) ‚Äì Original specification
- [PATCH_N0_IMPLEMENTATION_GUIDE.md](./PATCH_N0_IMPLEMENTATION_GUIDE.md) ‚Äì Implementation details
- [PATCH_N_SERIES_ROLLUP.md](./PATCH_N_SERIES_ROLLUP.md) ‚Äì Complete N-series overview

---

## ‚úÖ Completion Checklist

- [x] Backend API (7 endpoints)
- [x] Custom posts JSON storage
- [x] Builtin posts loading (5 posts)
- [x] TypeScript API client
- [x] PostManager component
- [x] PostEditor component
- [x] Route integration (/lab/posts)
- [x] CAM Dashboard card
- [x] Smoke test (14/14 pass)
- [x] Validation system
- [x] Token reference system
- [x] Builtin protection (403 Forbidden)

---

**Status:** ‚úÖ N.0 Smart Post Configurator **COMPLETE**  
**Ready for:** Production use, custom post creation, CNC workflow integration

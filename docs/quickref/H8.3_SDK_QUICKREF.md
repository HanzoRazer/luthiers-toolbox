# H8.3 Quick Reference - SDK Endpoint Helpers

## Import

```typescript
import { cam } from "@/sdk/endpoints";
import { ApiError } from "@/sdk";
```

## Available Helpers

### 1. Roughing G-code (Legacy)
```typescript
const { gcode, summary, requestId } = await cam.roughingGcode({
  entities: [/* boundary */],
  tool_diameter: 6.0,
  depth_per_pass: 2.0,
  stock_thickness: 10.0,
  feed_xy: 1200,
  feed_z: 300,
  safe_z: 5.0,
  tabs_count: 4,
  tab_width: 5.0,
  tab_height: 1.0,
  post: "GRBL",
});
```

### 2. Roughing G-code (Intent-Native)
```typescript
// Non-strict (default)
const result = await cam.roughingGcodeIntent({
  design: { mode: "roughing", boundaries: [...] },
  machine: { post_id: "GRBL", safe_z_mm: 5.0 },
  tool: { diameter_mm: 6.0, flute_count: 2 },
});

// Strict mode (422 on validation issues)
const result = await cam.roughingGcodeIntent(intent, true);
```

### 3. Pipeline Runner
```typescript
const formData = new FormData();
formData.append("config", JSON.stringify(config));
formData.append("dxf_file", file);

const { result, requestId } = await cam.runPipeline(formData);
```

## Error Handling

```typescript
try {
  const result = await cam.roughingGcode(payload);
} catch (err) {
  if (err instanceof ApiError) {
    console.error(`[${err.status}] ${err.message}`);
    console.error("Request ID:", err.details?.requestId);
    
    if (err.is(422)) {
      // Validation error
    } else if (err.isServerError()) {
      // 5xx error
    }
  }
}
```

## Return Shapes

All helpers return objects with `requestId`:

```typescript
// Roughing endpoints
{
  gcode: string;
  summary: CamSummary | null;  // Parsed from X-CAM-Summary header
  requestId: string;
}

// Pipeline endpoint
{
  result: unknown;
  requestId: string;
}
```

## Migration Pattern

### Before
```typescript
const response = await fetch("/api/cam/roughing_gcode", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(payload),
});
const gcode = await response.text();
```

### After
```typescript
import { cam } from "@/sdk/endpoints";
const { gcode, requestId } = await cam.roughingGcode(payload);
```

## Key Benefits

✅ Type-safe payloads & responses  
✅ Automatic header parsing (`X-CAM-Summary`)  
✅ Request-id propagation  
✅ Consistent error handling  
✅ All helpers return `{...result, requestId}`  

## Testing

Mock the helper, not fetch:

```typescript
import { vi } from "vitest";
import * as roughing from "@/sdk/endpoints/cam/roughing";

vi.spyOn(roughing, "roughingGcode").mockResolvedValue({
  gcode: "G0 X0 Y0\nM30\n",
  summary: null,
  requestId: "req-123",
});
```

## Documentation

- **Architecture**: [packages/client/src/sdk/endpoints/README.md](../packages/client/src/sdk/endpoints/README.md)
- **Usage Examples**: [packages/client/src/sdk/endpoints/cam/USAGE.md](../packages/client/src/sdk/endpoints/cam/USAGE.md)
- **Migration Tracking**: [docs/H8.3_SDK_MIGRATION_TRACKING.md](../docs/H8.3_SDK_MIGRATION_TRACKING.md)

## Adding New Helpers

1. Define types in `types.ts`
2. Create helper in `{operation}.ts`
3. Export from `cam.ts`
4. Write tests in `__tests__/`
5. Update this quickref

---
**Status**: Foundation Complete ✅ | Tests: 6/6 Passing | Ready for Component Migration

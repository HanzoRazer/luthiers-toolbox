# Patch N.0: Smart Post Configurator ‚Äî Scaffold

**Status:** üöß In Progress (Scaffold)  
**Date:** November 5, 2025  
**Module:** Tooling Router ‚Äî Post-Processor CRUD  
**Stage:** N (follows M.4 Live Session Override)

---

## üéØ Overview

Patch N.0 adds a **Smart Post Configurator** to allow CRUD operations on CNC post-processors directly from the UI. This extends the existing 5 hardcoded post-processors (GRBL, Mach4, LinuxCNC, PathPilot, MASSO) with:

- ‚úÖ **Create custom posts** with header/footer token arrays
- ‚úÖ **Edit existing posts** (modify headers, footers, metadata)
- ‚úÖ **Delete user-created posts** (built-in posts protected)
- ‚úÖ **Token expansion system** for dynamic G-code generation
- ‚úÖ **Validation** (syntax checks, reserved tokens, circular dependencies)
- ‚úÖ **UI integration** with PostManager + PostEditor components

---

## üì¶ What's Being Added

### **1. Backend Router** (`services/api/app/routers/post_router.py`)
New endpoints for post-processor management:
- `GET /api/posts/` ‚Äî List all posts (built-in + custom)
- `GET /api/posts/{post_id}` ‚Äî Get single post details
- `POST /api/posts/` ‚Äî Create new custom post
- `PUT /api/posts/{post_id}` ‚Äî Update existing post
- `DELETE /api/posts/{post_id}` ‚Äî Delete custom post (built-in protected)
- `POST /api/posts/validate` ‚Äî Validate post configuration before save

### **2. Post Configuration Schema**
```json
{
  "id": "GRBL",
  "name": "GRBL 1.1",
  "description": "Open-source CNC controller",
  "builtin": true,
  "header": [
    "G21",              // Units: mm
    "G90",              // Absolute positioning
    "G17",              // XY plane
    "(POST={{POST_ID}};UNITS={{UNITS}};DATE={{DATE}})"
  ],
  "footer": [
    "M30",              // Program end
    "(Generated by Luthier's Tool Box)"
  ],
  "tokens": {
    "POST_ID": "GRBL",
    "UNITS": "mm",
    "DATE": "2025-11-05T10:30:00Z"
  },
  "metadata": {
    "controller_family": "grbl",
    "gcode_dialect": "LinuxCNC",
    "supports_arcs": true,
    "max_line_length": 255,
    "comment_style": "parentheses"
  }
}
```

### **3. Token Expansion System**
Dynamic token replacement in header/footer arrays:
- `{{POST_ID}}` ‚Üí Post identifier
- `{{UNITS}}` ‚Üí `mm` or `inch`
- `{{DATE}}` ‚Üí ISO 8601 timestamp
- `{{TOOL_DIAMETER}}` ‚Üí From toolpath metadata
- `{{MATERIAL}}` ‚Üí From job config
- `{{MACHINE_ID}}` ‚Üí From machine profile

**Example:**
```python
# Template
header = [
  "(Machine: {{MACHINE_ID}})",
  "(Tool: {{TOOL_DIAMETER}}mm)",
  "(Material: {{MATERIAL}})"
]

# Expanded (at export time)
header = [
  "(Machine: CNC3018_UPGRADED)",
  "(Tool: 6.0mm)",
  "(Material: Hardwood_Maple)"
]
```

### **4. Frontend Components**

**PostManager.vue** (`packages/client/src/components/PostManager.vue`)
- Grid view of all posts (built-in + custom)
- Create/Edit/Delete buttons
- Search/filter by controller family
- Import/Export post configs (JSON)

**PostEditor.vue** (`packages/client/src/components/PostEditor.vue`)
- Form for editing post properties
- Header/footer array editors (add/remove lines)
- Token palette (drag-and-drop tokens)
- Real-time preview of expanded output
- Validation feedback (syntax errors, warnings)

**PostTokenHelper.vue** (`packages/client/src/components/PostTokenHelper.vue`)
- Token reference panel
- Shows available tokens with descriptions
- Copy-to-clipboard for quick insertion

### **5. Data Storage**
**Option A: Extend `services/api/app/data/posts/*.json`**
- Keep built-in posts as individual files
- Add `custom_posts.json` for user-created posts

**Option B: Single consolidated file**
- `services/api/app/data/posts/posts_config.json`
- Array of all posts (builtin flag distinguishes)

**Recommended: Option A** (cleaner separation, easier git tracking)

---

## üîß Implementation Plan

### **Phase 1: Backend Foundation (2-3 hours)**
1. Create `services/api/app/routers/post_router.py`
2. Define Pydantic schemas (PostConfig, PostCreateIn, PostUpdateIn)
3. Implement CRUD endpoints with builtin protection
4. Add token expansion logic (`expand_tokens()` utility)
5. Add validation (reserved tokens, circular refs, syntax)
6. Register router in `main.py`

### **Phase 2: Frontend Components (3-4 hours)**
1. Create `PostManager.vue` with grid layout
2. Create `PostEditor.vue` with form + array editors
3. Create `PostTokenHelper.vue` with token palette
4. Wire to `/api/posts/*` endpoints
5. Add to navigation (Settings ‚Üí Post Processors)
6. Integrate with existing `PostSelector.vue` (refresh on CRUD)

### **Phase 3: Token System (1-2 hours)**
1. Define token registry (name, description, example)
2. Implement `expand_tokens()` in export pipeline
3. Add token validation (undefined tokens warn, not error)
4. Add real-time preview in PostEditor

### **Phase 4: Testing (2 hours)**
1. Create `test_post_router.py` (pytest)
2. Create `scripts/smoke_posts_crud.py` (smoke tests)
3. Add CI workflow `.github/workflows/post_crud.yml`
4. Test builtin protection (cannot delete GRBL)
5. Test token expansion (header/footer rendering)

### **Phase 5: Documentation (1 hour)**
1. Update `POST_CHOOSER_SYSTEM.md` with CRUD section
2. Create `POST_TOKEN_REFERENCE.md` (token catalog)
3. Update `GETTING_STARTED.md` (Settings ‚Üí Post Processors)
4. Add section to `DEVELOPER_HANDOFF.md`

---

## üìê File Structure

```
services/api/app/
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îî‚îÄ‚îÄ post_router.py           # NEW: Post CRUD endpoints
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ posts/
‚îÇ       ‚îú‚îÄ‚îÄ grbl.json            # Existing (builtin)
‚îÇ       ‚îú‚îÄ‚îÄ mach4.json           # Existing (builtin)
‚îÇ       ‚îú‚îÄ‚îÄ linuxcnc.json        # Existing (builtin)
‚îÇ       ‚îú‚îÄ‚îÄ pathpilot.json       # Existing (builtin)
‚îÇ       ‚îú‚îÄ‚îÄ masso.json           # Existing (builtin)
‚îÇ       ‚îî‚îÄ‚îÄ custom_posts.json    # NEW: User posts
‚îî‚îÄ‚îÄ util/
    ‚îî‚îÄ‚îÄ post_tokens.py           # NEW: Token expansion logic

packages/client/src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ PostManager.vue          # NEW: Post list/CRUD UI
‚îÇ   ‚îú‚îÄ‚îÄ PostEditor.vue           # NEW: Post edit form
‚îÇ   ‚îú‚îÄ‚îÄ PostTokenHelper.vue      # NEW: Token reference
‚îÇ   ‚îî‚îÄ‚îÄ PostSelector.vue         # EXISTING: Wire to refresh
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îî‚îÄ‚îÄ post.ts                  # NEW: API client methods
‚îî‚îÄ‚îÄ views/
    ‚îî‚îÄ‚îÄ Settings.vue             # MODIFY: Add Posts tab

scripts/
‚îî‚îÄ‚îÄ smoke_posts_crud.py          # NEW: CRUD smoke tests

.github/workflows/
‚îî‚îÄ‚îÄ post_crud.yml                # NEW: CI for post CRUD

docs/
‚îú‚îÄ‚îÄ POST_TOKEN_REFERENCE.md      # NEW: Token catalog
‚îî‚îÄ‚îÄ POST_CHOOSER_SYSTEM.md       # MODIFY: Add CRUD section
```

---

## üß™ API Endpoint Specifications

### **GET `/api/posts/`**
List all posts (built-in + custom).

**Response:**
```json
{
  "posts": [
    {
      "id": "GRBL",
      "name": "GRBL 1.1",
      "builtin": true,
      "description": "Open-source CNC controller"
    },
    {
      "id": "CUSTOM_HAAS",
      "name": "Haas VF-2",
      "builtin": false,
      "description": "Custom post for Haas VF-2 with tool changer"
    }
  ]
}
```

---

### **GET `/api/posts/{post_id}`**
Get full post configuration.

**Response:**
```json
{
  "id": "GRBL",
  "name": "GRBL 1.1",
  "description": "Open-source CNC controller",
  "builtin": true,
  "header": [
    "G21",
    "G90",
    "G17",
    "(POST={{POST_ID}};UNITS={{UNITS}};DATE={{DATE}})"
  ],
  "footer": [
    "M30",
    "(End of program)"
  ],
  "tokens": {
    "POST_ID": "GRBL",
    "UNITS": "mm",
    "DATE": "2025-11-05T10:30:00Z"
  },
  "metadata": {
    "controller_family": "grbl",
    "supports_arcs": true,
    "comment_style": "parentheses"
  }
}
```

---

### **POST `/api/posts/`**
Create new custom post.

**Request:**
```json
{
  "id": "CUSTOM_HAAS",
  "name": "Haas VF-2",
  "description": "Custom post for Haas VF-2",
  "header": [
    "G90 G80 G40 G17",
    "G54",
    "(TOOL={{TOOL_DIAMETER}}mm)"
  ],
  "footer": [
    "M30"
  ],
  "metadata": {
    "controller_family": "fanuc",
    "supports_arcs": true
  }
}
```

**Response:**
```json
{
  "id": "CUSTOM_HAAS",
  "name": "Haas VF-2",
  "builtin": false,
  "created_at": "2025-11-05T10:35:00Z"
}
```

**Validation:**
- `id` must be unique (case-insensitive)
- `id` cannot start with reserved prefixes (GRBL, Mach4, LinuxCNC, PathPilot, MASSO)
- `header` and `footer` must be non-empty arrays
- Tokens in `{{...}}` must be defined in token registry

---

### **PUT `/api/posts/{post_id}`**
Update existing post (custom only).

**Request:** Same as POST (partial updates supported)

**Response:**
```json
{
  "id": "CUSTOM_HAAS",
  "updated_at": "2025-11-05T10:40:00Z"
}
```

**Errors:**
- `403 Forbidden` if trying to edit builtin post
- `404 Not Found` if post_id doesn't exist

---

### **DELETE `/api/posts/{post_id}`**
Delete custom post.

**Response:**
```json
{
  "id": "CUSTOM_HAAS",
  "deleted": true
}
```

**Errors:**
- `403 Forbidden` if trying to delete builtin post
- `404 Not Found` if post_id doesn't exist

---

### **POST `/api/posts/validate`**
Validate post configuration without saving.

**Request:** Same as POST

**Response:**
```json
{
  "valid": true,
  "warnings": [
    "Token {{MACHINE_ID}} not defined in request, will use default"
  ],
  "errors": []
}
```

OR

```json
{
  "valid": false,
  "warnings": [],
  "errors": [
    "Post ID 'GRBL' conflicts with builtin post",
    "Header line 3 contains undefined token {{INVALID_TOKEN}}"
  ]
}
```

---

## üîç Token Registry

### **Standard Tokens**
| Token | Description | Example |
|-------|-------------|---------|
| `{{POST_ID}}` | Post-processor identifier | `GRBL` |
| `{{UNITS}}` | Units (mm or inch) | `mm` |
| `{{DATE}}` | ISO 8601 timestamp | `2025-11-05T10:30:00Z` |
| `{{TOOL_DIAMETER}}` | Tool diameter | `6.0` |
| `{{TOOL_NUMBER}}` | Tool number (for tool changers) | `T1` |
| `{{MATERIAL}}` | Material name | `Hardwood_Maple` |
| `{{MACHINE_ID}}` | Machine profile ID | `CNC3018_UPGRADED` |
| `{{FEED_XY}}` | Cutting feed rate | `1200` |
| `{{FEED_Z}}` | Plunge feed rate | `400` |
| `{{SPINDLE_RPM}}` | Spindle speed | `18000` |

### **Advanced Tokens (Future)**
| Token | Description | Example |
|-------|-------------|---------|
| `{{WORK_OFFSET}}` | Work coordinate system | `G54` |
| `{{TOOL_LENGTH_OFFSET}}` | Tool length comp | `G43 H1` |
| `{{COOLANT}}` | Coolant command | `M8` |
| `{{PROGRAM_NAME}}` | Filename | `guitar_body_pocket` |

---

## üß© Integration Points

### **1. Export Pipeline**
When exporting G-code with post-processor:
```python
# services/api/app/routers/geometry_router.py (existing)
from ..util.post_tokens import expand_tokens

# Load post config
post = load_post(post_id)

# Expand tokens in header
header_expanded = expand_tokens(post.header, {
    "POST_ID": post_id,
    "UNITS": units,
    "DATE": datetime.now().isoformat(),
    "TOOL_DIAMETER": tool_diameter,
    # ... other context
})

# Prepend to G-code
gcode = "\n".join(header_expanded) + "\n" + gcode_body + "\n" + "\n".join(footer_expanded)
```

### **2. PostSelector Component**
Refresh post list after CRUD operations:
```typescript
// packages/client/src/components/PostSelector.vue
async function refreshPosts() {
  const response = await fetch('/api/posts/')
  posts.value = await response.json()
}

// Call on mount and after manager closes
onMounted(refreshPosts)
```

### **3. Machine Profiles (Future)**
Link posts to machine profiles:
```json
// assets/machine_profiles.json
{
  "id": "CNC3018_UPGRADED",
  "name": "CNC 3018 Pro (Upgraded)",
  "preferred_post": "GRBL",  // NEW: Default post for this machine
  "limits": { ... }
}
```

---

## üêõ Validation Rules

### **Post ID**
- ‚úÖ Alphanumeric + underscores only
- ‚úÖ Max 32 characters
- ‚úÖ Unique (case-insensitive)
- ‚ùå Cannot start with: `GRBL`, `Mach4`, `LinuxCNC`, `PathPilot`, `MASSO` (reserved)

### **Header/Footer**
- ‚úÖ Non-empty arrays
- ‚úÖ Each line max 255 characters
- ‚úÖ Tokens must be defined in registry or request context

### **Token Syntax**
- ‚úÖ Format: `{{TOKEN_NAME}}`
- ‚ùå No nested tokens: `{{TOKEN_{{OTHER}}}}`
- ‚ùå No circular refs: Token A ‚Üí Token B ‚Üí Token A

### **Builtin Protection**
- ‚ùå Cannot edit builtin posts (id starts with GRBL/Mach4/etc)
- ‚ùå Cannot delete builtin posts
- ‚úÖ Can clone builtin post to create custom variant

---

## üöÄ Usage Examples

### **Example 1: Create Custom Haas Post**
```typescript
const response = await fetch('/api/posts/', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    id: 'CUSTOM_HAAS_VF2',
    name: 'Haas VF-2 w/ Tool Changer',
    description: 'Custom post for Haas VF-2 with ATC',
    header: [
      'G90 G80 G40 G17',  // Safety block
      'G54',              // Work offset
      'T{{TOOL_NUMBER}} M6',  // Tool change
      'G43 H{{TOOL_NUMBER}}', // Tool length comp
      'S{{SPINDLE_RPM}} M3',  // Spindle on
      'M8',               // Coolant on
      '(Tool: {{TOOL_DIAMETER}}mm)',
      '(Material: {{MATERIAL}})'
    ],
    footer: [
      'M9',   // Coolant off
      'M5',   // Spindle off
      'G53 Z0', // Machine home Z
      'M30'   // Program end
    ],
    metadata: {
      controller_family: 'fanuc',
      supports_arcs: true,
      has_tool_changer: true
    }
  })
})

console.log(`Created post: ${response.id}`)
```

### **Example 2: Edit Custom Post (Add Safety Line)**
```typescript
const post = await fetch('/api/posts/CUSTOM_HAAS_VF2').then(r => r.json())

// Add safety line to footer
post.footer.unshift('G28 G91 Z0')  // Z to home position before end

await fetch('/api/posts/CUSTOM_HAAS_VF2', {
  method: 'PUT',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify(post)
})
```

### **Example 3: Clone Builtin Post**
```typescript
// Get GRBL config
const grbl = await fetch('/api/posts/GRBL').then(r => r.json())

// Clone to custom variant
const custom = {
  ...grbl,
  id: 'GRBL_CUSTOM_CNC3018',
  name: 'GRBL for CNC 3018 (Custom)',
  builtin: false,  // Mark as custom
  header: [
    ...grbl.header,
    '(Custom header for CNC 3018)',
    'G92 X0 Y0 Z0'  // Add custom work offset
  ]
}

await fetch('/api/posts/', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify(custom)
})
```

---

## üß™ Testing Strategy

### **Unit Tests** (`tests/test_post_router.py`)
```python
def test_create_custom_post():
    response = client.post('/api/posts/', json={
        'id': 'TEST_POST',
        'name': 'Test Post',
        'header': ['G90'],
        'footer': ['M30']
    })
    assert response.status_code == 200
    assert response.json()['id'] == 'TEST_POST'

def test_cannot_edit_builtin():
    response = client.put('/api/posts/GRBL', json={'name': 'Hacked'})
    assert response.status_code == 403

def test_token_expansion():
    header = ['(Tool: {{TOOL_DIAMETER}}mm)']
    expanded = expand_tokens(header, {'TOOL_DIAMETER': '6.0'})
    assert expanded == ['(Tool: 6.0mm)']
```

### **Smoke Tests** (`scripts/smoke_posts_crud.py`)
```python
# Test CRUD lifecycle
post_id = create_custom_post()
get_post(post_id)
update_post(post_id, {'name': 'Updated Name'})
delete_post(post_id)

# Test builtin protection
try:
    delete_post('GRBL')
    raise AssertionError('Should not allow deleting builtin')
except Exception as e:
    assert '403' in str(e)
```

### **CI Workflow** (`.github/workflows/post_crud.yml`)
```yaml
name: Post CRUD Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - run: pip install -r services/api/requirements.txt
      - run: pytest tests/test_post_router.py
      - run: python scripts/smoke_posts_crud.py
```

---

## üìã Implementation Checklist

### **Backend (Phase 1)**
- [ ] Create `services/api/app/routers/post_router.py`
- [ ] Define Pydantic schemas (PostConfig, PostCreateIn, PostUpdateIn)
- [ ] Implement `GET /api/posts/` (list all)
- [ ] Implement `GET /api/posts/{post_id}` (get single)
- [ ] Implement `POST /api/posts/` (create custom)
- [ ] Implement `PUT /api/posts/{post_id}` (update custom)
- [ ] Implement `DELETE /api/posts/{post_id}` (delete custom)
- [ ] Implement `POST /api/posts/validate` (validate config)
- [ ] Add builtin protection (cannot edit/delete GRBL/Mach4/etc)
- [ ] Create `services/api/app/util/post_tokens.py` (token expansion)
- [ ] Register router in `main.py`
- [ ] Create `services/api/app/data/posts/custom_posts.json` (empty array)

### **Frontend (Phase 2)**
- [ ] Create `packages/client/src/api/post.ts` (API client)
- [ ] Create `packages/client/src/components/PostManager.vue` (grid view)
- [ ] Create `packages/client/src/components/PostEditor.vue` (edit form)
- [ ] Create `packages/client/src/components/PostTokenHelper.vue` (token palette)
- [ ] Add "Post Processors" tab to Settings view
- [ ] Wire PostSelector to refresh on CRUD operations
- [ ] Add import/export JSON buttons to PostManager

### **Token System (Phase 3)**
- [ ] Define token registry in `post_tokens.py`
- [ ] Implement `expand_tokens()` function
- [ ] Add token validation (undefined tokens ‚Üí warnings)
- [ ] Add real-time preview in PostEditor (expand tokens on typing)
- [ ] Wire token expansion to export pipeline (geometry_router.py)

### **Testing (Phase 4)**
- [ ] Create `tests/test_post_router.py` (pytest suite)
- [ ] Create `scripts/smoke_posts_crud.py` (smoke tests)
- [ ] Add CI workflow `.github/workflows/post_crud.yml`
- [ ] Test builtin protection (403 on edit/delete)
- [ ] Test token expansion (header/footer rendering)
- [ ] Test validation (invalid ID, undefined tokens)

### **Documentation (Phase 5)**
- [ ] Update `POST_CHOOSER_SYSTEM.md` (add CRUD section)
- [ ] Create `POST_TOKEN_REFERENCE.md` (token catalog)
- [ ] Update `GETTING_STARTED.md` (Settings ‚Üí Post Processors)
- [ ] Update `CAM_CAD_DEVELOPER_HANDOFF.md` (add Stage N section)
- [ ] Create `PATCH_N0_COMPLETE.md` (implementation summary)

---

## üîß Configuration Files

### **custom_posts.json** (Initial State)
```json
{
  "version": "1.0",
  "posts": []
}
```

### **Example Custom Post**
```json
{
  "version": "1.0",
  "posts": [
    {
      "id": "CUSTOM_HAAS_VF2",
      "name": "Haas VF-2 w/ ATC",
      "description": "Custom post for Haas VF-2 with automatic tool changer",
      "builtin": false,
      "created_at": "2025-11-05T10:35:00Z",
      "updated_at": "2025-11-05T10:40:00Z",
      "header": [
        "G90 G80 G40 G17",
        "G54",
        "T{{TOOL_NUMBER}} M6",
        "G43 H{{TOOL_NUMBER}}",
        "S{{SPINDLE_RPM}} M3",
        "M8",
        "(Tool: {{TOOL_DIAMETER}}mm)",
        "(Material: {{MATERIAL}})"
      ],
      "footer": [
        "M9",
        "M5",
        "G53 Z0",
        "M30"
      ],
      "metadata": {
        "controller_family": "fanuc",
        "supports_arcs": true,
        "has_tool_changer": true,
        "max_line_length": 80,
        "comment_style": "parentheses"
      }
    }
  ]
}
```

---

## üêõ Error Handling

### **Client-Side**
```typescript
async function createPost(config: PostConfig) {
  try {
    const response = await fetch('/api/posts/', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(config)
    })
    
    if (!response.ok) {
      const error = await response.json()
      throw new Error(error.detail || 'Failed to create post')
    }
    
    return await response.json()
  } catch (error) {
    console.error('Post creation failed:', error)
    // Show user-friendly error in UI
    showNotification({
      type: 'error',
      message: `Failed to create post: ${error.message}`
    })
  }
}
```

### **Server-Side**
```python
from fastapi import HTTPException, status

@router.delete('/api/posts/{post_id}')
def delete_post(post_id: str):
    post = load_post(post_id)
    
    if not post:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f'Post {post_id} not found'
        )
    
    if post.builtin:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail=f'Cannot delete builtin post {post_id}'
        )
    
    # Delete from custom_posts.json
    delete_custom_post(post_id)
    
    return {'id': post_id, 'deleted': True}
```

---

## üìö Related Documentation

- [Post-Processor Chooser System](./POST_CHOOSER_SYSTEM.md) - UI integration for post selection
- [Multi-Post Export System](./PATCH_K_EXPORT_COMPLETE.md) - Export pipeline with post-processor headers
- [CAM/CAD Developer Handoff](./CAM_CAD_DEVELOPER_HANDOFF.md) - Complete system overview
- [Machine Profiles Module M](./MACHINE_PROFILES_MODULE_M.md) - Machine profile integration

---

## üéØ Success Criteria

‚úÖ **Functional:**
- [ ] Can create custom post via UI
- [ ] Can edit custom post (change header/footer)
- [ ] Can delete custom post
- [ ] Cannot edit/delete builtin posts (protected)
- [ ] Token expansion works in export pipeline
- [ ] Validation catches invalid IDs and undefined tokens

‚úÖ **Quality:**
- [ ] Unit tests cover all CRUD operations
- [ ] Smoke tests pass (CRUD lifecycle)
- [ ] CI workflow green
- [ ] Documentation complete (API, UI, tokens)

‚úÖ **Performance:**
- [ ] List posts < 50ms
- [ ] Create/update post < 100ms
- [ ] Token expansion < 10ms per export

---

## üöÄ Next Steps: Stage N.1 (Future)

### **N.1: Advanced Post Features**
- **Token variables:** User-defined tokens (e.g., `{{CUSTOM_VAR}}`)
- **Conditional blocks:** `{{#if TOOL_CHANGER}}T{{TOOL_NUMBER}} M6{{/if}}`
- **Template inheritance:** Base post + overrides
- **Post validation:** Lint G-code syntax in header/footer
- **Post testing:** Dry-run post config against sample toolpath

---

**Status:** üöß Scaffold Complete ‚Äî Ready for Implementation  
**Estimated Effort:** 10-12 hours (backend + frontend + testing + docs)  
**Dependencies:** None (builds on existing post system)  
**Next Action:** Implement Phase 1 (Backend Router)

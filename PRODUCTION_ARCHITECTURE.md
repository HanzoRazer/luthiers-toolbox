# ğŸ—ï¸ Production Architecture Diagrams

## Table of Contents
- [Network Architecture](#network-architecture)
- [Request Flow](#request-flow)
- [Container Orchestration](#container-orchestration)
- [Build Pipeline](#build-pipeline)
- [Deployment Flow](#deployment-flow)

---

## Network Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Internet / External Network                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â”‚ Port 80 (HTTP)
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nginx Front Proxy Container                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ nginx:1.27-alpine                                       â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚ Routes:                                                 â”‚ â”‚
â”‚ â”‚  â€¢ /api/*      â†’ proxy_pass to api:8000                â”‚ â”‚
â”‚ â”‚  â€¢ /health     â†’ proxy_pass to api:8000/health         â”‚ â”‚
â”‚ â”‚  â€¢ /docs       â†’ proxy_pass to api:8000/docs           â”‚ â”‚
â”‚ â”‚  â€¢ /assets/*   â†’ serve from /usr/share/nginx/html      â”‚ â”‚
â”‚ â”‚  â€¢ /*          â†’ serve index.html (Vue SPA)            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                               â”‚
          â”‚ Internal Bridge Network       â”‚
          â”‚ (toolbox_network)            â”‚
          â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API Container      â”‚         â”‚ Client Assets     â”‚
    â”‚                    â”‚         â”‚ (Volume)          â”‚
    â”‚ python:3.11-slim   â”‚         â”‚                   â”‚
    â”‚ FastAPI + uvicorn  â”‚         â”‚ Vue built files   â”‚
    â”‚ Port 8000          â”‚         â”‚ from Vite         â”‚
    â”‚ (internal only)    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                    â”‚
    â”‚ Volume:            â”‚
    â”‚ â””â”€ api_data/       â”‚
    â”‚    â””â”€ tool_lib.db  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request Flow

### API Request

```
User Browser
    â”‚
    â”‚ GET http://yoursite.com/api/cam/simulate_gcode
    â”‚ POST { "gcode": "G21 G90\nG2 X60 Y40 I30 J20" }
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nginx Container (:80)                   â”‚
â”‚                                         â”‚
â”‚ Location /api/ matched                  â”‚
â”‚   proxy_pass http://api:8000/          â”‚
â”‚   + Headers:                            â”‚
â”‚     X-Real-IP: client_ip                â”‚
â”‚     X-Forwarded-For: client_ip          â”‚
â”‚     Host: yoursite.com                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Internal network request
                â”‚ http://api:8000/cam/simulate_gcode
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Container (:8000)                   â”‚
â”‚                                         â”‚
â”‚ FastAPI receives request                â”‚
â”‚   â†“                                     â”‚
â”‚ Router: /cam/simulate_gcode             â”‚
â”‚   â†“                                     â”‚
â”‚ sim_validate.py:                        â”‚
â”‚   - Parse G-code                        â”‚
â”‚   - Calculate arc centers (IJK/R)       â”‚
â”‚   - Estimate time                       â”‚
â”‚   - Check safety                        â”‚
â”‚   â†“                                     â”‚
â”‚ Return JSON:                            â”‚
â”‚   { "moves": [...],                     â”‚
â”‚     "summary": {...},                   â”‚
â”‚     "issues": [] }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Response
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nginx Container                         â”‚
â”‚   â†“                                     â”‚
â”‚ Proxy response back                     â”‚
â”‚ + Add headers:                          â”‚
â”‚   X-Cache-Status: MISS                  â”‚
â”‚   Access-Control-Allow-Origin: *        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTP Response
                â†“
            User Browser
            (receives JSON)
```

### Static Asset Request

```
User Browser
    â”‚
    â”‚ GET http://yoursite.com/assets/app.js
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nginx Container (:80)                   â”‚
â”‚                                         â”‚
â”‚ Location ~* \.(js|css|...)$ matched     â”‚
â”‚   try_files $uri =404                   â”‚
â”‚   â†“                                     â”‚
â”‚ Read from:                              â”‚
â”‚   /usr/share/nginx/html/assets/app.js   â”‚
â”‚   â†“                                     â”‚
â”‚ Add headers:                            â”‚
â”‚   Cache-Control: public, immutable      â”‚
â”‚   Expires: 1 year                       â”‚
â”‚   Content-Encoding: gzip                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTP 200 OK (with caching)
                â†“
            User Browser
            (caches for 1 year)
```

### Vue Router Request

```
User Browser
    â”‚
    â”‚ GET http://yoursite.com/calculator/string-spacing
    â”‚ (Vue Router path, no file exists)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nginx Container (:80)                   â”‚
â”‚                                         â”‚
â”‚ Location / matched                      â”‚
â”‚   try_files $uri $uri/ /index.html      â”‚
â”‚   â†“                                     â”‚
â”‚ File not found â†’ Fallback to index.html â”‚
â”‚   â†“                                     â”‚
â”‚ Read from:                              â”‚
â”‚   /usr/share/nginx/html/index.html      â”‚
â”‚   â†“                                     â”‚
â”‚ Add headers:                            â”‚
â”‚   Cache-Control: no-cache, no-store     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ HTTP 200 OK (index.html)
                â†“
            User Browser
            â†“
        Vue Router parses URL
            â†“
        Loads /calculator/string-spacing component
```

---

## Container Orchestration

### docker-compose.production.yml

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Docker Compose Stack                                       â”‚
â”‚                                                            â”‚
â”‚ Networks:                                                  â”‚
â”‚   toolbox_network (bridge)                                â”‚
â”‚                                                            â”‚
â”‚ Volumes:                                                   â”‚
â”‚   api_data (local driver)                                 â”‚
â”‚   client_assets (local driver)                            â”‚
â”‚                                                            â”‚
â”‚ Services:                                                  â”‚
â”‚                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ api                                                 â”‚   â”‚
â”‚ â”‚   build: docker/api/Dockerfile                     â”‚   â”‚
â”‚ â”‚   image: ghcr.io/.../luthiers-toolbox-api:latest   â”‚   â”‚
â”‚ â”‚   networks: [toolbox_network]                      â”‚   â”‚
â”‚ â”‚   volumes: [api_data:/app/services/api/app/data]   â”‚   â”‚
â”‚ â”‚   healthcheck: curl http://127.0.0.1:8000/health   â”‚   â”‚
â”‚ â”‚   restart: unless-stopped                          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â–²                                â”‚
â”‚                          â”‚ depends_on (service_healthy)   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ client                                             â”‚   â”‚
â”‚ â”‚   build: docker/client/Dockerfile.production       â”‚   â”‚
â”‚ â”‚   image: ghcr.io/.../luthiers-toolbox-client       â”‚   â”‚
â”‚ â”‚   networks: [toolbox_network]                      â”‚   â”‚
â”‚ â”‚   volumes: [client_assets:/usr/share/nginx/html]   â”‚   â”‚
â”‚ â”‚   restart: unless-stopped                          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â–²                                â”‚
â”‚                          â”‚ depends_on (service_healthy)   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ nginx                                              â”‚   â”‚
â”‚ â”‚   build: docker/nginx/Dockerfile                   â”‚   â”‚
â”‚ â”‚   image: ghcr.io/.../luthiers-toolbox-nginx        â”‚   â”‚
â”‚ â”‚   networks: [toolbox_network]                      â”‚   â”‚
â”‚ â”‚   ports: ["80:80"]  â† ONLY EXPOSED PORT            â”‚   â”‚
â”‚ â”‚   volumes: [client_assets:/usr/share/nginx/html:ro]â”‚   â”‚
â”‚ â”‚   healthcheck: wget http://localhost:80/health     â”‚   â”‚
â”‚ â”‚   restart: unless-stopped                          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Startup Sequence

```
1. docker compose up -d
      â†“
2. Create network: toolbox_network
      â†“
3. Create volumes: api_data, client_assets
      â†“
4. Start API container
      â†“
5. Wait for API health check (10s interval, 10 retries)
      â†“ (Health: OK)
6. Start Client container
      â†“
7. Start Nginx container
      â†“
8. System ready (all containers running)
```

---

## Build Pipeline

### Multi-Stage Client Build

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ docker/client/Dockerfile.production                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Stage 1: Builder (node:20-alpine)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FROM node:20-alpine AS builder      â”‚
â”‚ WORKDIR /app                        â”‚
â”‚   â†“                                 â”‚
â”‚ COPY client/package*.json ./        â”‚
â”‚   â†“                                 â”‚
â”‚ RUN npm ci --production=false       â”‚
â”‚   (installs all dependencies)       â”‚
â”‚   â†“                                 â”‚
â”‚ COPY client/ ./                     â”‚
â”‚   (copy Vue source code)            â”‚
â”‚   â†“                                 â”‚
â”‚ RUN npm run build                   â”‚
â”‚   (vite builds to /app/dist)        â”‚
â”‚   â†“                                 â”‚
â”‚ Verify: test -f dist/index.html     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ dist/
              â”‚  â”œâ”€ index.html
              â”‚  â”œâ”€ assets/
              â”‚  â”‚   â”œâ”€ app.js (bundled)
              â”‚  â”‚   â””â”€ app.css (bundled)
              â”‚  â””â”€ ...
              â†“
Stage 2: Runtime (nginx:1.27-alpine)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FROM nginx:1.27-alpine              â”‚
â”‚   â†“                                 â”‚
â”‚ COPY --from=builder /app/dist       â”‚
â”‚      /usr/share/nginx/html          â”‚
â”‚   (only built assets, no node_modules)â”‚
â”‚   â†“                                 â”‚
â”‚ COPY nginx configs                  â”‚
â”‚   â†“                                 â”‚
â”‚ EXPOSE 80                           â”‚
â”‚   â†“                                 â”‚
â”‚ CMD ["nginx", "-g", "daemon off;"]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: ~40MB image (nginx + built assets only)
```

### API Build

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ docker/api/Dockerfile               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FROM python:3.11-slim
    â†“
Install system deps (curl, ca-certs, build-essential)
    â†“
COPY requirements.txt
    â†“
RUN pip install --no-cache-dir -r requirements.txt
    (Layer cached if requirements unchanged)
    â†“
COPY services/api/
    â†“
Create non-root user 'app'
    â†“
USER app
    â†“
EXPOSE 8000
    â†“
HEALTHCHECK curl http://127.0.0.1:8000/health
    â†“
CMD ["python", "-m", "uvicorn", "..."]

Result: ~300MB image (Python + deps + code)
```

---

## Deployment Flow

### CI/CD Pipeline (GitHub Actions)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trigger: Push to main / Create tag v1.0.0                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job: build-and-push (matrix: api, client, nginx)           â”‚
â”‚                                                             â”‚
â”‚ 1. Checkout repository                                      â”‚
â”‚      â†“                                                      â”‚
â”‚ 2. Set up Docker Buildx (multi-platform)                    â”‚
â”‚      â†“                                                      â”‚
â”‚ 3. Login to ghcr.io                                         â”‚
â”‚      (uses GITHUB_TOKEN)                                    â”‚
â”‚      â†“                                                      â”‚
â”‚ 4. Extract metadata                                         â”‚
â”‚      - main â†’ tags: latest, main-abc123                     â”‚
â”‚      - v1.0.0 â†’ tags: v1.0.0, 1.0, 1, latest               â”‚
â”‚      â†“                                                      â”‚
â”‚ 5. Build and push (parallel for 3 components)               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ API         â”‚ Client       â”‚ Nginx        â”‚          â”‚
â”‚    â”‚  Build      â”‚  Build       â”‚  Build       â”‚          â”‚
â”‚    â”‚  Multi-stageâ”‚  Multi-stage â”‚  Simple      â”‚          â”‚
â”‚    â”‚  amd64+arm64â”‚  amd64+arm64 â”‚  amd64+arm64 â”‚          â”‚
â”‚    â”‚  Push       â”‚  Push        â”‚  Push        â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚      â†“                                                      â”‚
â”‚ 6. Generate artifact attestation                            â”‚
â”‚      (cryptographic proof of build)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job: verify-images (depends on build-and-push)             â”‚
â”‚                                                             â”‚
â”‚ 1. Pull published images                                    â”‚
â”‚      â†“                                                      â”‚
â”‚ 2. Inspect images (verify metadata)                         â”‚
â”‚      â†“                                                      â”‚
â”‚ 3. Launch test stack with compose                           â”‚
â”‚      â†“                                                      â”‚
â”‚ 4. Wait for health checks                                   â”‚
â”‚      â†“                                                      â”‚
â”‚ 5. Run smoke tests                                          â”‚
â”‚      - curl http://localhost:8080/health                    â”‚
â”‚      - curl http://localhost:8080/api/health                â”‚
â”‚      â†“                                                      â”‚
â”‚ 6. Tear down test stack                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â†“ (if tag v*.*.*)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Job: create-release (only on version tags)                 â”‚
â”‚                                                             â”‚
â”‚ 1. Create GitHub Release                                    â”‚
â”‚      â†“                                                      â”‚
â”‚ 2. Generate release notes                                   â”‚
â”‚      â†“                                                      â”‚
â”‚ 3. Add deployment instructions                              â”‚
â”‚      - Pull commands                                        â”‚
â”‚      - Docker compose example                               â”‚
â”‚      - Access URLs                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Result: 3 images published to ghcr.io with attestations
```

### Server Deployment

```
Production Server (VPS/Cloud VM)
    â”‚
    â”‚ 1. docker login ghcr.io
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Authenticated to GitHub Container       â”‚
â”‚ Registry                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 2. docker compose pull
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pull 3 images from ghcr.io:             â”‚
â”‚  â€¢ api:latest (~300MB)                  â”‚
â”‚  â€¢ client:latest (~40MB)                â”‚
â”‚  â€¢ nginx:latest (~45MB)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 3. docker compose up -d
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create network, volumes                 â”‚
â”‚   â†“                                     â”‚
â”‚ Start API container                     â”‚
â”‚   â†“                                     â”‚
â”‚ Wait for API health                     â”‚
â”‚   â†“ (Health: OK after 5s)               â”‚
â”‚ Start Client container                  â”‚
â”‚   â†“                                     â”‚
â”‚ Start Nginx container                   â”‚
â”‚   â†“                                     â”‚
â”‚ All containers running                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Port 80 open
                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System accessible:                      â”‚
â”‚  â€¢ http://server-ip/                    â”‚
â”‚  â€¢ http://server-ip/api                 â”‚
â”‚  â€¢ http://server-ip/docs                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Update Flow

```
New Code Pushed
    â†“
GitHub Actions builds new images
    â†“
Images tagged with new commit SHA
    â†“
Server pulls new images
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ docker compose up -d                    â”‚
â”‚   â†“                                     â”‚
â”‚ Detects image changes                   â”‚
â”‚   â†“                                     â”‚
â”‚ For each changed container:             â”‚
â”‚   1. Pull new image                     â”‚
â”‚   2. Stop old container                 â”‚
â”‚   3. Start new container                â”‚
â”‚   4. Wait for health check              â”‚
â”‚   5. Remove old container               â”‚
â”‚   â†“                                     â”‚
â”‚ Rolling update complete                 â”‚
â”‚   (zero downtime if health checks pass) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monitoring Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Health Check Loop (every 10s)           â”‚
â”‚                                         â”‚
â”‚ Nginx:                                  â”‚
â”‚   wget http://localhost:80/health       â”‚
â”‚     â†“ (proxy to API)                    â”‚
â”‚ API:                                    â”‚
â”‚   curl http://127.0.0.1:8000/health     â”‚
â”‚     â†“                                   â”‚
â”‚ Response: {"ok": true}                  â”‚
â”‚     â†“                                   â”‚
â”‚ If fails 3 times â†’ restart container    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Logs Collection                         â”‚
â”‚                                         â”‚
â”‚ docker compose logs -f                  â”‚
â”‚   â†“                                     â”‚
â”‚ Streams from all containers:            â”‚
â”‚   api    | INFO: Started uvicorn        â”‚
â”‚   nginx  | 192.168.1.1 GET /api/health  â”‚
â”‚   client | (no logs - static assets)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resource Monitoring                     â”‚
â”‚                                         â”‚
â”‚ docker stats                            â”‚
â”‚   â†“                                     â”‚
â”‚ Container | CPU % | MEM USAGE | NET I/O â”‚
â”‚ nginx     | 0.5%  | 10MB      | 1KB/s   â”‚
â”‚ api       | 2.1%  | 120MB     | 5KB/s   â”‚
â”‚ client    | 0.0%  | 5MB       | 0B      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Summary Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Complete Production System                                    â”‚
â”‚                                                               â”‚
â”‚ Development                                                   â”‚
â”‚   â†“ git push                                                  â”‚
â”‚ GitHub Actions                                                â”‚
â”‚   â†“ build (5 min)                                            â”‚
â”‚ GHCR (ghcr.io)                                               â”‚
â”‚   â†“ docker pull                                              â”‚
â”‚ Production Server                                             â”‚
â”‚   â†“ docker compose up -d                                     â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚ â”‚ Internet     â”‚                                             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚        â”‚ :80                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ â”‚ Nginx Proxy                                â”‚              â”‚
â”‚ â”‚  - Routes /api â†’ FastAPI                   â”‚              â”‚
â”‚ â”‚  - Serves Vue SPA                          â”‚              â”‚
â”‚ â”‚  - Security headers                        â”‚              â”‚
â”‚ â”‚  - Gzip compression                        â”‚              â”‚
â”‚ â”‚  - Asset caching                           â”‚              â”‚
â”‚ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚    â”‚ internal       â”‚ volume                                â”‚
â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚ FastAPI     â”‚  â”‚ Vue Assets â”‚                            â”‚
â”‚ â”‚  - G-code   â”‚  â”‚  - Built   â”‚                            â”‚
â”‚ â”‚    sim      â”‚  â”‚    with    â”‚                            â”‚
â”‚ â”‚  - Tool lib â”‚  â”‚    Vite    â”‚                            â”‚
â”‚ â”‚  - Feeds/   â”‚  â”‚  - Static  â”‚                            â”‚
â”‚ â”‚    speeds   â”‚  â”‚    files   â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                               â”‚
â”‚ Health Checks: All green                                     â”‚
â”‚ Resource Usage: <5% CPU, <150MB RAM                         â”‚
â”‚ Uptime: 99.9%+ with restart policies                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Status**: ğŸŸ¢ **ARCHITECTURE DOCUMENTED**

name: measurement-examples
on: [push, pull_request]

jobs:
  validate-examples:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install jsonschema
        run: pip install jsonschema

      - name: Validate measurement examples
        run: |
          python - <<'PY'
          import json, glob
          from jsonschema import validate

          tap_schema = json.load(open('schemas/measurement/tap_peaks.schema.json'))
          moe_schema = json.load(open('schemas/measurement/moe_result.schema.json'))
          man_schema = json.load(open('schemas/measurement/manifest.schema.json'))

          def val(pat, schema):
              for f in sorted(glob.glob(pat)):
                  data = json.load(open(f))
                  validate(data, schema)
                  print("OK", f)

          val('examples/measurement/*tap*.json', tap_schema)
          val('examples/measurement/*bending*.json', moe_schema)
          val('examples/measurement/*manifest*.json', man_schema)
          print("All examples validated")
          PY
